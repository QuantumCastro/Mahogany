# Worklog - 2025-11-06 Vault MVP

## Inputs
- Functional/UX spec: static Obsidian-like vault with 10 notes, backlinks, search operators, graph.
- Stack baseline: Next.js 14 (App Router), TailwindCSS, pnpm workspace (`frontend/`).
- Dataset: `frontend/content/demo/*.md` with YAML frontmatter and optional local assets.
- Required contracts: `vault.json`, `notes.index.json`, `links.json`, `graph.json`.

## Target outputs
- Static export ready for Vercel covering `/`, `/n/{slug}`, `/graph`, `/search`, `/tags`, `/tags/{tag}`, `/about`, fallback `/*`.
- Deterministic generation of per-note HTML and unique JSON bundles under `public/data/`.
- AA-focused UX with keyboard shortcuts (`/`, `g`), dark/light theme and ES/EN toggle.
- Documentation refreshed (README + ADR) and sample dataset versioned.

## Assumptions
- Vault lives in `frontend/content/demo`; no remote data sources.
- `title` is mandatory in frontmatter; every other key becomes part of `properties` unless reserved.
- Embeds (`![[...]]`) only link to local notes/assets; external URLs remain blocked.
- `graph.json` must stay under 50 KB for this dataset.
- Default language is `en`, but surfaces provide ES/EN copy via i18n provider.

## Preconditions
- Node.js >=20.10 and pnpm >=9 available (`corepack enable pnpm`).
- Dependencies installed at repo root (`pnpm install`).
- `frontend/content/demo` populated before running `pnpm dev`/`build` (build script regenerates contracts if needed).

## Postconditions
- `pnpm --dir frontend build` succeeds and emits `/out` plus the four JSON contracts.
- `pnpm --dir frontend test` / `lint` remain green; any regression is documented.
- README describes ingestion/build/deploy steps; ADR logs ingestion decisions.
- Graph data loads only on `/graph`; direct navigation to any route works after export.

## Invariants
- Each note keeps a stable `id`, unique slug (collisions resolved via `-n` suffix) and ISO `updatedAt`.
- `links.json` mirrors wikilinks exactly; unresolved targets set `isBroken=true`.
- UI backlinks derive from the inverse of `links.json`.
- All JSON files regenerate together via `pnpm --dir frontend run vault:build`.
- Home/Note payload budgets <150 KB gzip by deferring graph/script-heavy assets.

## Edge cases tracked
- Empty vault: Home/Search show empty states with Retry/About CTAs.
- Broken links/assets: label unresolved links and display placeholder thumbnails.
- `[[Alias#Heading]]` with missing target is treated as plain text + warning entry.
- Search queries containing only exclusions suggest using `tag:#...`.
- `prefers-reduced-motion` users see “Load graph” CTA and reduced animation settings.
- Theme/i18n are persisted via `localStorage`; fall back to defaults when storage is unavailable.

